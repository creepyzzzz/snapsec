"use client";

import React from 'react';
import { motion } from "framer-motion";
import { ShieldAlert, TrendingUp, Search, MoreHorizontal, Bell, Lock, Server, Globe } from 'lucide-react';

import { cn } from "@/lib/utils";
import { AnimatedNumber } from '@/components/ui/animated-number';

const Card = ({ children, className }: { children: React.ReactNode; className?: string }) => (
    <div className={cn("bg-zinc-900/40 border border-zinc-800/40 rounded-lg p-2.5 sm:p-3 flex flex-col backdrop-blur-sm transition-all duration-300", className)}>
        {children}
    </div>
);

const MacOSHeader = () => (
    <div className="flex items-center justify-between px-3 py-2 border-b border-zinc-800/60 bg-zinc-900/50 rounded-t-lg select-none backdrop-blur-md">
        <div className="flex gap-1.5">
            <div className="w-2.5 h-2.5 rounded-full bg-[#FF5F56] border border-[#E0443E]/50 shadow-sm" />
            <div className="w-2.5 h-2.5 rounded-full bg-[#FFBD2E] border border-[#DEA123]/50 shadow-sm" />
            <div className="w-2.5 h-2.5 rounded-full bg-[#27C93F] border border-[#1AAB29]/50 shadow-sm" />
        </div>
        <div className="flex items-center gap-1.5 text-[10px] sm:text-[11px] font-medium text-zinc-500/80">
            <ShieldAlert className="w-3 h-3" />
            <span>Snapsec Vulnerability Center</span>
        </div>
        <div className="w-10" />
    </div>
);

export const VulnerabilityDashboard = () => {
    return (
        <div className="w-full h-full flex flex-col font-sans select-none p-1 sm:p-2 overflow-hidden">
            {/* Window Container */}
            <motion.div
                initial={{ opacity: 0, scale: 0.95, y: 10 }}
                animate={{ opacity: 1, scale: 1, y: 0 }}
                transition={{ duration: 0.5, ease: "easeOut" }}
                className="w-full h-full mx-auto rounded-lg border border-zinc-800/60 bg-black/60 backdrop-blur-2xl shadow-2xl shadow-black/80 flex flex-col"
            >
                <MacOSHeader />

                {/* Dashboard Content */}
                <div className="flex-1 p-3 sm:p-4 overflow-y-auto overflow-x-hidden flex flex-col gap-3 text-xs custom-scrollbar">

                    {/* Toolbar */}
                    <div className="flex items-center justify-between shrink-0">
                        <div className="flex items-center gap-2">
                            <h2 className="text-zinc-100 font-medium text-sm tracking-tight">Overview</h2>
                            <div className="h-4 w-[1px] bg-zinc-800 hidden sm:block" />
                            <p className="text-zinc-500 text-[10px] hidden sm:block">Live Metrics</p>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="hidden sm:flex items-center gap-1.5 px-2 py-1 bg-zinc-900/50 border border-zinc-800/60 rounded text-zinc-500 text-[10px] hover:border-zinc-700 transition-colors cursor-text min-w-[140px]">
                                <Search className="w-3 h-3" />
                                <span>Search...</span>
                            </div>
                        </div>
                    </div>

                    {/* KPI Cards Strip - More Compact */}
                    <div className="grid grid-cols-2 lg:grid-cols-4 gap-2.5 shrink-0">
                        <Card className="hover:bg-zinc-900/60 hover:border-zinc-700/50 group py-2">
                            <div className="text-zinc-500 text-[9px] font-medium uppercase tracking-wider mb-1 group-hover:text-zinc-400">Total Vulns</div>
                            <div className="flex items-end justify-between">
                                <div className="text-lg font-medium text-white">
                                    <AnimatedNumber value={287} springOptions={{ bounce: 0, duration: 2000 }} />
                                </div>
                                <div className="flex items-center gap-0.5 text-[9px] text-zinc-400 bg-zinc-800/40 px-1 py-0.5 rounded border border-zinc-800/50">
                                    <TrendingUp className="w-2 h-2" /> 5%
                                </div>
                            </div>
                        </Card>
                        <Card className="hover:bg-zinc-900/60 hover:border-zinc-700/50 group py-2">
                            <div className="text-zinc-500 text-[9px] font-medium uppercase tracking-wider mb-1 group-hover:text-zinc-400">Critical</div>
                            <div className="flex items-end justify-between">
                                <div className="text-lg font-medium text-white">
                                    <AnimatedNumber value={23} springOptions={{ bounce: 0, duration: 2000 }} />
                                </div>
                                <div className="w-1.5 h-1.5 rounded-full bg-zinc-100 shadow-[0_0_6px_rgba(255,255,255,0.4)]" />
                            </div>
                        </Card>
                        <Card className="hover:bg-zinc-900/60 hover:border-zinc-700/50 group py-2">
                            <div className="text-zinc-500 text-[9px] font-medium uppercase tracking-wider mb-1 group-hover:text-zinc-400">High Priority</div>
                            <div className="flex items-end justify-between">
                                <div className="text-lg font-medium text-white">
                                    <AnimatedNumber value={147} springOptions={{ bounce: 0, duration: 2000 }} />
                                </div>
                                <div className="w-1.5 h-1.5 rounded-full bg-zinc-400" />
                            </div>
                        </Card>
                        <Card className="hover:bg-zinc-900/60 hover:border-zinc-700/50 group py-2">
                            <div className="text-zinc-500 text-[9px] font-medium uppercase tracking-wider mb-1 group-hover:text-zinc-400">Score</div>
                            <div className="flex items-end justify-between">
                                <div className="text-lg font-medium text-white">A+</div>
                                <div className="text-[9px] text-zinc-500">Top 5%</div>
                            </div>
                        </Card>
                    </div>

                    {/* Main Content Split */}
                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-2.5 grow min-h-0">
                        {/* Severity Distribution */}
                        <Card className="lg:col-span-2 hover:border-zinc-700/50 overflow-hidden">
                            <div className="flex items-center justify-between mb-3">
                                <h3 className="text-zinc-300 font-medium text-[11px]">Severity Distribution</h3>
                                <div className="flex gap-2 text-[9px] text-zinc-500">
                                    <span className="flex items-center gap-1"><div className="w-1 h-1 rounded-full bg-zinc-100" /> Crit</span>
                                    <span className="flex items-center gap-1"><div className="w-1 h-1 rounded-full bg-zinc-400" /> High</span>
                                </div>
                            </div>
                            <div className="space-y-3.5 pr-1 overflow-auto custom-scrollbar h-full">
                                {[
                                    { label: "Production API", icon: Server, crit: 8, high: 32, med: 14 },
                                    { label: "Auth Service", icon: Lock, crit: 3, high: 8, med: 2 },
                                    { label: "Public Gateway", icon: Globe, crit: 2, high: 24, med: 35 },
                                    { label: "CI/CD Pipeline", icon: Server, crit: 1, high: 5, med: 12 },
                                ].map((item, i) => (
                                    <div key={i} className="group">
                                        <div className="flex justify-between items-center text-[10px] mb-1">
                                            <div className="flex items-center gap-1.5">
                                                <item.icon className="w-2.5 h-2.5 text-zinc-600 group-hover:text-zinc-400 transition-colors" />
                                                <span className="text-zinc-400 group-hover:text-zinc-200 transition-colors">{item.label}</span>
                                            </div>
                                            <span className="text-zinc-600 font-mono text-[9px]">
                                                <AnimatedNumber value={item.crit + item.high + item.med} springOptions={{ bounce: 0, duration: 2000 }} />
                                            </span>
                                        </div>
                                        <div className="h-1 w-full bg-zinc-800/30 rounded-full flex overflow-hidden">
                                            <motion.div initial={{ width: 0 }}
                                                animate={{ width: `${(item.crit / (item.crit + item.high + item.med)) * 100}%` }}
                                                transition={{ duration: 1, delay: i * 0.1 }} className="bg-zinc-100" />
                                            <motion.div initial={{ width: 0 }}
                                                animate={{ width: `${(item.high / (item.crit + item.high + item.med)) * 100}%` }}
                                                transition={{ duration: 1, delay: i * 0.1 + 0.1 }} className="bg-zinc-400/80" />
                                            <motion.div initial={{ width: 0 }}
                                                animate={{ width: `${(item.med / (item.crit + item.high + item.med)) * 100}%` }}
                                                transition={{ duration: 1, delay: i * 0.1 + 0.2 }} className="bg-zinc-700/50" />
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </Card>

                        {/* Activity Log */}
                        <Card className="hover:border-zinc-700/50 overflow-hidden">
                            <div className="flex items-center justify-between mb-2">
                                <h3 className="text-zinc-300 font-medium text-[11px]">Live Log</h3>
                            </div>
                            <div className="relative h-full overflow-hidden">
                                <div className="absolute inset-0 flex flex-col gap-0.5 overflow-y-auto custom-scrollbar pr-1">
                                    {[
                                        { icon: Lock, msg: "SQLi attempt blocked", src: "auth-db", time: "2s", type: "crit" },
                                        { icon: Globe, msg: "New port detected", src: "public-lb", time: "45s", type: "high" },
                                        { icon: Server, msg: "Service restarted", src: "api-worker", time: "2m", type: "info" },
                                        { icon: Lock, msg: "Weak cipher suite", src: "legacy-app", time: "5m", type: "med" },
                                        { icon: Globe, msg: "Outbound traffic spike", src: "nat-gateway", time: "12m", type: "high" },
                                        { icon: Server, msg: "Patch applied", src: "backend-core", time: "1h", type: "info" },
                                    ].map((log, i) => (
                                        <div key={i} className="flex items-center gap-2 p-1.5 rounded hover:bg-zinc-800/30 transition-colors group cursor-default">
                                            <div className={cn("w-1 h-1 rounded-full shrink-0", log.type === 'crit' ? 'bg-zinc-100' : log.type === 'high' ? 'bg-zinc-400' : 'bg-zinc-700')} />
                                            <span className="text-zinc-400 text-[9px] truncate w-full group-hover:text-zinc-200 transition-colors code-font">{log.msg}</span>
                                            <span className="text-[8px] text-zinc-600 font-mono shrink-0">{log.time}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </Card>
                    </div>

                </div>

                {/* Status Footer */}
                <div className="px-3 py-1.5 border-t border-zinc-800/60 bg-zinc-900/30 flex items-center justify-between text-[8px] sm:text-[9px] text-zinc-600">
                    <div className="flex items-center gap-1.5">
                        <div className="w-1 h-1 rounded-full bg-zinc-400 animate-pulse" />
                        <span className="font-medium">System Online</span>
                    </div>
                    <div className="flex gap-3 font-mono opacity-60">
                        <span>CPU: 12%</span>
                        <span>MEM: 240MB</span>
                    </div>
                </div>
            </motion.div>
        </div>
    );
};
